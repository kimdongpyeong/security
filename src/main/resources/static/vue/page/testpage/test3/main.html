<div class="liveStreamingApplyWrap" style="margin-top: 100px;">

	<v-row>
		<v-col cols="3" style="text-align:center;">
			<v-btn outlined @click="goPersonalRoom()">1:1 커뮤니티로 가기</v-btn>
			<v-btn outlined @click="visible.userList = true;">친구목록</v-btn>
		</v-col>
		<template v-if="noticeList.length > 0">
			<v-col cols="9">
				<template v-if="noticeBoxFlag">
				  <el-alert
				    title="공지사항"
				    type="warning"
				    :description="noticeContent"
				    @close="closeNotice()">
				  </el-alert>
				</template>
			  <template v-else>
	  			<el-button type="warning" icon="el-icon-bell" circle  @click="openNotice()"></el-button>
  				<el-button type="danger" icon="el-icon-delete" circle @click="removeNotice(noticeList[0])"></el-button>
			  </template>
			</v-col>
		</template>
	</v-row>
	<!-- 채팅 -->
	<template>
		<vue-advanced-chat 
			height="100vh" 
			:current-user-id="currentUserId" 
			:messages-loaded="messagesLoaded"
			:room-id="roomId"
			:rooms-loaded="roomsLoaded"
			:menu-actions="menuActions"
			@add-room="addRoom"
			@menu-action-handler="menuActionHandler"
			@typing-message="typingMessage"
			@fetch-messages="fetchMessages"
			@fetch-more-rooms="fetchMoreRooms"
			@send-message="sendMessage"
		    @edit-message="editMessage"
		    @notice-message="noticeMessage"
		    @delete-message="deleteMessage"
            @open-file="openFile"/>
            
	</template>
	
	<div class="demo-image__preview">
		<el-image
			:visible.sync="visible.imgVisible"
			:preview-src-list="srcList"
			:src="fileSrc"
			style="width: 100px; height: 100px"
		></el-image>
	</div>
	<!-- 채팅방 수정 및 삭제 -->
	<el-dialog class="addClassPop" title="룸 설정" :visible.sync="visible.roomListFormVisible"
		:close-on-click-modal="false" :close-on-press-escape="false" :before-close="cancel">
		<el-divider content-position="left">채팅방 관리</el-divider>
		<v-row dense>
        	<v-col cols="10" style="align-self: center;">
       		<input type="file"  ref="roomProfile" value="select.selectedRoom.saveFileNm"
                        accept="image/*" style="display:none;" @change="thumbFile($event);" />
                <label @click="$refs.roomProfile.click();">
                    <img :src="data.roomProfile"
                        alt="이미지"
                        style="width: 70%; height: 200px;"/>
                </label>
        	</v-col>
        </v-row>
        <v-row dense>
        	<v-col cols="1"></v-col>
        	<v-col cols="10" style="align-self: center;">
        		<div style="text-align:center;">
		        	<font>채팅방 이름</font><p>
			        <el-input
			          style="border-bottom: double; "
					  v-model="select.selectedRoom.title"
			  		  maxlength="50"
					  clearable>
					</el-input>
				</div>
        	</v-col>
        </v-row>
        <v-row>
        	<v-col cols="1"></v-col>
        	<v-col cols="10" style="align-self: center;">
        		<div style="text-align:center;">
		        	<font>채팅방 소개글</font><p>
			        <el-input
			          style="border-bottom: solid 1px; "
					  v-model="select.selectedRoom.introduction"
			  		  maxlength="50"
					  clearable>
					</el-input>
				</div>
        	</v-col>
        </v-row>
        <v-row dense>
        	<v-col cols="1"></v-col>
        	<v-col cols="5">
        		<div style="text-align:center;">
	        		<font>최대인원</font><p>
	        		<el-input-number size="small" v-model="select.selectedRoom.maxMember" :min="select.selectedRoom.userCnt" :max="20"></el-input-number><p>
	  				<span style="font-size:12px;align-self:left;">*20명까지 설정가능합니다<p>*현재 참여하고 있는 인원보다<p>작은 수로 설정이 불가합니다.</span>
  				</div>
        	</v-col>
        	<v-col cols="5">
        		<div style="text-align:center;">
	        		<font>방장 설정</font><p>
	        		<v-select
			          :items="select.roomUser"
					  v-model="select.selectedRoom.createdBy"
			        ></v-select>
				</div>
        	</v-col>
        </v-row>
        <v-row>
        	<v-col cols="1"></v-col>
        	<v-col cols="5">
                <div style="text-align: center; padding: inherit; border: 1px solid #EAEAEA;">
	        		<font>비밀번호 설정</font>
                    <div class="pb-2 mt-2 ">
                        <el-radio v-model="select.selectedRoom.codeYn" label="Y">예</el-radio>
                        <el-radio v-model="select.selectedRoom.codeYn" label="N">아니오</el-radio>
                    </div>
                </div>
        	</v-col>
        	<v-col cols="5">
        		<template v-if="select.selectedRoom.codeYn === 'Y'">
	        		<div style="text-align:center;">
		        		<font>비밀번호</font>
		  				<el-input style="border-bottom: double;" placeholder="숫자 4자 입력해주세요" maxlength="4" v-model="select.selectedRoom.code" show-password></el-input-number>
	  				</div>
  				</template>
        	</v-col>
        </v-row>
        <v-row dense>
        	<v-col style="text-align: end;">
        		<el-button round plain @click="cancel()">Cancel</el-button>
  				<el-button type="danger" round plain @click="modifyRoom('delete')">Delete</el-button>
  				<el-button type="primary" round plain @click="modifyRoom()">Modify</el-button>
        	</v-col>
        </v-row>
	</el-dialog>
	<!-- 채팅방별 참여 유저 관리 -->
	<el-dialog class="addClassPop" title="참여 유저 관리" :visible.sync="visible.roomUserFormVisible"
		:close-on-click-modal="false" :close-on-press-escape="false" :before-close="cancel">
		<el-divider content-position="left">참여 유저 관리</el-divider>
        <v-row dense>
        	<v-col cols="1"></v-col>
        	<v-col cols="5" style="align-self: center;">
        		<div style="text-align:center;">
		        	<font>채팅방 이름</font><p>
			        <el-input
			          style="border-bottom: double; "
					  v-model="room.title"
			  		  maxlength="50"
					  clearable
					  readonly>
					</el-input>
				</div>
        	</v-col>
        	<v-col cols="5">
        		<div style="text-align:center;">
	        		<font>유저 닉네임</font><p>
	  				<el-input
			          style="border-bottom: double; "
					  v-model="select.userNickname"
			  		  maxlength="20"
					  clearable
					  >
					</el-input>
  				</div>
        	</v-col>
        </v-row>
        <v-row dense>
        	<v-col style="text-align: end;">
        		<el-button round plain @click="cancel()">Cancel</el-button>
  				<el-button type="warning" round plain @click="removeUser()">Expel</el-button>
  				<el-button type="primary" round plain @click="inviteUser()">Invite</el-button>
        	</v-col>
        </v-row>
        <el-divider />
		<template>
			</v-data-table>
			<v-simple-table dense fixed-header height="300px">
				<template v-slot:default >
					<thead>
						<tr>
							<th style="text-align: center;" scope="row">닉네임</th>
						</tr>
					</thead>
					<tbody>
						<tr
							v-for="(item, i) in select.selectedRoom.users"
							:key="item.id"
							@click="selectUser(item.username);"
						>
							<td style="text-align: center;">{{select.selectedRoom.createdBy === item._id ? "👑 "+item.username : item.username}}</td>
							<td style="text-align: center;"><el-button v-if="item._id !== currentUserId" size="mini" @click="userChat(item._id, item.username)" >1:1채팅하기</el-button></td>
						</tr>
					</tbody>
				</template>
			</v-simple-table>
		</template>
	</el-dialog>
	
	<!-- room 추가 -->
	<el-dialog 
		:visible.sync="visible.addRoomVisible" 
        :close-on-click-modal="false"
        :close-on-press-escape="false"
        >
        <el-divider content-position="left">채팅방 생성</el-divider>
        <v-row dense>
        	<v-col cols="10" style="align-self: center;">
        		<input type="file" v-model="newRoom.roomProfile" ref="roomProfile"
                        accept="image/*" style="display:none;" @change="thumbFile($event);" />
                <label @click="$refs.roomProfile.click();">
                    <img :src="data.roomProfile"
                        alt="이미지"
                        style="width: 70%; height: 200px;"/>
                </label>
        	</v-col>
        </v-row>
        <v-row dense>
        	<v-col cols="1"></v-col>
        	<v-col cols="5" style="align-self: center;">
        		<div style="text-align:center;">
		        	<font>채팅방 이름</font><p>
			        <el-input
			          style="border-bottom: double; "
					  v-model="newRoom.title"
			  		  maxlength="50"
					  clearable>
					</el-input>
				</div>
        	</v-col>
        	<v-col cols="5">
        		<div style="text-align:center;">
	        		<font>최대인원</font><p>
	  				<el-input-number size="small" v-model="newRoom.maxMember" :min="1" :max="20"></el-input-number><p>
	  				<span style="font-size:12px;align-self:left;">*20명까지 설정가능합니다</span>
  				</div>
        	</v-col>
        </v-row>
        <v-row>
        	<v-col cols="1"></v-col>
        	<v-col cols="10" style="align-self: center;">
        		<div style="text-align:center;">
		        	<font>채팅방 소개글</font><p>
			        <el-input
			          style="border-bottom: solid 1px; "
					  v-model="newRoom.introduction"
			  		  maxlength="50"
					  clearable>
					</el-input>
				</div>
        	</v-col>
        </v-row>
        <v-row>
        	<v-col cols="1"></v-col>
        	<v-col cols="5">
                <div style="text-align: center; padding: inherit; border: 1px solid #EAEAEA;">
	        		<font>비밀번호 설정</font>
                    <div class="pb-2 mt-2 ">
                        <el-radio v-model="newRoom.codeYn" label="Y">예</el-radio>
                        <el-radio v-model="newRoom.codeYn" label="N">아니오</el-radio>
                    </div>
                </div>
        	</v-col>
        	<v-col cols="5">
        		<template v-if="newRoom.codeYn === 'Y'">
	        		<div style="text-align:center;">
		        		<font>비밀번호</font>
		  				<el-input style="border-bottom: double;" placeholder="숫자 4자 입력해주세요" maxlength="4" v-model="newRoom.code" show-password></el-input-number>
	  				</div>
  				</template>
        	</v-col>
        </v-row>
        <v-row dense>
        	<v-col style="text-align: end;">
        		<el-button round plain @click="newRoomReset()">Reset</el-button>
  				<el-button type="primary" round plain @click="createRoom()">Create</el-button>
        	</v-col>
        </v-row>
        <el-divider content-position="left">채팅방 전체 목록</el-divider>
        <template>
		  <el-table
		    :data="allRooms.filter(data => !search || data.roomName.toLowerCase().includes(search.toLowerCase()))"
		    style="width: 100%; text-align: center;">
		    <el-table-column label="채팅방" prop="roomName">
		    </el-table-column>
		    <el-table-column label="참여인원" prop="count">
		    </el-table-column>
		    <el-table-column align="right">
		      <template slot="header" slot-scope="scope">
		        <el-input v-model="search" size="mini" placeholder="채팅방 검색"/>
		      </template>
		      <template slot-scope="scope">
			      <template v-if="!scope.row.roomBoss">
			        <el-button size="mini" v-if="scope.row.enterFlag" type="danger" plain @click="leaveChat(scope.row)">out</el-button>
			        <el-button size="mini" v-else @click="enterRoom(scope.row)">입장</el-button>
			      </template>
			      <template v-else>
					<i class="el-icon-cherry"></i>
			      </template>
		      </template>
		    </el-table-column>
		  </el-table>
	  </template>
	</el-dialog>
	<!-- 참여코드기재 팝업 -->
	<el-dialog 
		:title="secretRoom.roomName" 
		width="30%"
		:visible.sync="visible.enterCodeVisible"
        :close-on-click-modal="false"
        :close-on-press-escape="false">
		<v-row>
	       	<v-col style="align-self: center;">
	       		<div style="text-align:center;">
		        	<font>참여코드가 필요한 방입니다.<p>🔑참여코드를 입력해주세요🔑</font><p>
		  			<el-input 
			  			style="border-bottom: double; inline-size: max-content;" 
			  			placeholder="숫자 4자 입력해주세요" 
			  			maxlength="4" 
			  			v-model="codeCk" 
			  			show-password>
		  			</el-input-number>
				</div>
	       	</v-col>
		</v-row>
	  <span slot="footer" class="dialog-footer">
	    <el-button @click="visible.enterCodeVisible = false">취소</el-button>
	    <el-button type="primary" @click="sameCode()">확인</el-button>
	  </span>
	</el-dialog>
	
	<!-- 그룹채팅방 내 프로필사진 클릭 시, 뜨는 팝업 -->
	<div class="infoFormWrap">
		<el-dialog 
			title="프로필보기" 
			:visible.sync="store.state.app.chatProfile.flag"
			class="signUpWrap">
			<div class="contents">
                <div class="profileUpload">
	                <img
	                    :src="data.other.profile"
	                    alt="프로필 이미지"
	                />
                </div>
				<div class="nicknameBoxGroup" style="padding-top: 20px;text-align: center;">
					<font style="font-size: large;" >{{data.other.nickname}}</font>
				</div>
			</div>
			<div class="btnWrap">
				<template v-if="data.other.id !== currentUserId" >
					<button type="button" style="margin:0px" @click="userChat(data.other.id, data.other.nickname)">1:1 채팅하기</button>
				</template>
				<template v-else>
					<button type="button" style="margin:0px" @click="goMyPage()">마이페이지</button>
				</template>
			</div>
		</el-dialog>
	</div>
	<!-- 친구 목록 드로어 -->
	<el-drawer
	  title="친구 목록"
	  :visible.sync="visible.userList"
	  direction="rtl">
	  <template>
		<v-simple-table dense fixed-header>
			<template v-slot:default >
				<thead>
					<tr>
						<th colspan="2" style="text-align: center;" scope="row">닉네임</th>
					</tr>
				</thead>
				<tbody>
					<tr
						v-for="(user, i) in selectRoom.userList"
						:key="user._id"
						@click="showProfile(user._id)"
					>
						<td style="text-align: right;"><el-avatar size="small" :src="user.avatar"></el-avatar></td>
						<td>{{room.createdBy === user._id ? "👑 "+user.username : user.username}}</td>
						<td style="text-align: center;"><el-button v-if="user._id !== currentUserId" size="mini" @click="userChat(user._id, user.username)" >1:1채팅하기</el-button></td>
					</tr>
				</tbody>
			</template>
		</v-simple-table>
	  </template>
	</el-drawer>
</div>			